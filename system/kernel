local _build = 19
local args = { ... }

_dir = ""

_logfile = "/system/logs/logfile.log"
_lastlogfile = "/system/logs/last.log"

local _running = true

dofile("/system/modules/System.mm.lua")

dofile("/system/modules/Screen.mm.lua")

dofile("/system/modules/Directory.mm.lua")

dofile("/system/modules/String.mm.lua")

dofile("system/modules/Logger.mm.lua")

function kmain( ... )
	logfile = Logger.start()
	Logger.log("Loading MaCCOS kernel [build " .. _build .. "]")

	dofile("/system/system.lua")

	dofile("/system/init")

	state = start()
	if state == 0 then
		while _running do
			loop()
		end
	else
		printError("Error code: " .. state)
	end
	stop()
	Logger.stop(logfile)
end

local ok, err = pcall(function() kmain(unpack(args)) end)
if not ok then
	Logger.log("\nSomething went wrong :(")
	Logger.log(err)
	Logger.stop()
end
